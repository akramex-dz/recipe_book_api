<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Recipe App</title>
    <script src="https://cdn.jsdelivr.net/npm/@apollo/client@3.6.9"></script>
    <style>
      body {
        font-family: Arial, sans-serif;
        padding: 20px;
        background-color: #f4f4f9;
      }
      h1 {
        text-align: center;
        color: #333;
      }
      .form-container {
        max-width: 600px;
        margin: 0 auto;
        background-color: #fff;
        padding: 20px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
      }
      input, select, textarea {
        width: 100%;
        padding: 10px;
        margin: 10px 0;
        border-radius: 5px;
        border: 1px solid #ddd;
      }
      button {
        padding: 10px 20px;
        background-color: #4CAF50;
        color: white;
        border: none;
        border-radius: 5px;
        cursor: pointer;
      }
      button:hover {
        background-color: #45a049;
      }
      .recipes-list {
        margin-top: 20px;
        border-top: 2px solid #ddd;
        padding-top: 20px;
      }
      .recipe-item {
        margin: 10px 0;
        padding: 10px;
        background-color: #fafafa;
        border-radius: 5px;
      }
    </style>
  </head>
  <body>
    <h1>Test Recipe API</h1>

    <!-- Form to create a new recipe -->
    <div class="form-container">
      <h2>Create a New Recipe</h2>
      <form id="createRecipeForm">
        <input type="text" id="title" placeholder="Recipe Title" required />
        <textarea id="description" placeholder="Recipe Description" required></textarea>
        <input type="text" id="ingredients" placeholder="Ingredients (comma separated)" required />
        <input type="text" id="category" placeholder="Category" required />
        <input type="text" id="createdByUserId" placeholder="Created By (User ID)" required />
        <button type="submit">Create Recipe</button>
      </form>
    </div>

    <!-- Display recipes -->
    <div class="recipes-list" id="recipesList">
      <h2>Recipes</h2>
      <div id="recipeContainer"></div>
    </div>

    <script>
      const { ApolloClient, InMemoryCache, gql } = ApolloClient;

      const client = new ApolloClient({
        uri: 'http://localhost:4000', // Your GraphQL server URI
        cache: new InMemoryCache(),
      });

      const GET_RECIPES = gql`
        query {
          getRecipes {
            id
            title
            description
            ingredients
            category
          }
        }
      `;

      const CREATE_RECIPE = gql`
        mutation createRecipeWithDetails(
          $title: String!, 
          $description: String!, 
          $ingredients: [String!]!, 
          $category: String!, 
          $createdByUserId: ID!
        ) {
          createRecipeWithDetails(
            title: $title, 
            description: $description, 
            ingredients: $ingredients, 
            category: $category, 
            createdByUserId: $createdByUserId
          ) {
            id
            title
            description
            ingredients
            category
          }
        }
      `;

      // Fetch and display recipes
      function fetchRecipes() {
        client
          .query({ query: GET_RECIPES })
          .then((response) => {
            const recipes = response.data.getRecipes;
            const recipeContainer = document.getElementById('recipeContainer');
            recipeContainer.innerHTML = ''; // Clear existing recipes

            recipes.forEach((recipe) => {
              const recipeItem = document.createElement('div');
              recipeItem.classList.add('recipe-item');
              recipeItem.innerHTML = `
                <h3>${recipe.title}</h3>
                <p><strong>Description:</strong> ${recipe.description}</p>
                <p><strong>Ingredients:</strong> ${recipe.ingredients.join(', ')}</p>
                <p><strong>Category:</strong> ${recipe.category}</p>
              `;
              recipeContainer.appendChild(recipeItem);
            });
          })
          .catch((error) => {
            console.error('Error fetching recipes:', error);
          });
      }

      // Handle form submission to create a new recipe
      document.getElementById('createRecipeForm').addEventListener('submit', (e) => {
        e.preventDefault();

        const title = document.getElementById('title').value;
        const description = document.getElementById('description').value;
        const ingredients = document.getElementById('ingredients').value.split(',');
        const category = document.getElementById('category').value;
        const createdByUserId = document.getElementById('createdByUserId').value;

        client
          .mutate({
            mutation: CREATE_RECIPE,
            variables: { title, description, ingredients, category, createdByUserId },
          })
          .then((response) => {
            console.log('Recipe created:', response.data.createRecipeWithDetails);
            fetchRecipes(); // Refresh the recipes list
            document.getElementById('createRecipeForm').reset(); // Reset form
          })
          .catch((error) => {
            console.error('Error creating recipe:', error);
          });
      });

      // Initial fetch of recipes
      fetchRecipes();
    </script>
  </body>
</html>
